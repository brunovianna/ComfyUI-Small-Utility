(function(L,b){"use strict";const y={name:"smallutility.choose_latent_size",beforeRegisterNodeDef(p,i,t){if(i.name==="EmptyLatentImage"){const e=p.prototype.getExtraMenuOptions;p.prototype.getExtraMenuOptions=function(n,s){return e==null||e.apply(this,[n,s]),s.push({content:"SDXL Sizes",has_submenu:!0,callback(a,r,l,c,u){new b.ContextMenu(["768x1344","1024x1024","1344x768"],{event:l,callback(o,g,I,z,f){var d,v;const[N,C]=o.split("x").map(h=>parseInt(h)),_=(d=f==null?void 0:f.widgets)==null?void 0:d.find(h=>h.name==="width"),w=(v=f==null?void 0:f.widgets)==null?void 0:v.find(h=>h.name==="height");_&&(_.value=N),w&&(w.value=C)},parentMenu:c,node:u})}}),s}}}},x={name:"smallutility.eval_node",beforeRegisterNodeDef(p,i,t){if(i.name==="Eval"){const e=p.prototype.onNodeCreated;p.prototype.onNodeCreated=function(){e==null||e.apply(this),this.addWidget("STRING","result_type","*",function(n,s,a){if(typeof n=="string"||!a)return;const r=a.outputs;for(const l of r)l.name=n,l.type=n,l.localized_name=n})},p.prototype.onConnectionsChange=function(n,s,a,r,l){if(r&&n==1){!a&&this.inputs[s].name!=="cmd"&&this.removeInput(s);let c=0;for(let o=0;o<this.inputs.length;o++)this.inputs[o].name!=="cmd"&&(c++,this.inputs[o].name=`input${c}`);let u=this.inputs[this.inputs.length-1];u.name==="cmd"&&(u=this.inputs[this.inputs.length-2]),u.link&&(c++,this.addInput(`input${c}`,"*",{shape:7}))}}}}},k={name:"smallutility.sort_prompt",beforeRegisterNodeDef(p,i,t){if(i.name==="CLIPTextEncode"){const e=p.prototype.getExtraMenuOptions;p.prototype.getExtraMenuOptions=function(n,s){return e==null||e.apply(this,[n,s]),s.push({content:"sort prompt",callback(a,r,l,c,u){var g;const o=(g=u==null?void 0:u.widgets)==null?void 0:g[0];try{o&&(o.value=E(o.value))}catch{window.alert("sorting failed")}}}),s}}}},E=p=>{let i=[],t="",e=!1;const n=[];for(const s of p)switch(s){case"(":if(e)t+=s,e=!1;else{const a=i;i=[],n.push(a),a.push(i)}break;case")":if(e)t+=s,e=!1;else{t=t.trim();let a=/:\d+(\.\d+)?/.exec(t),r=null;for(a&&(t=t.substring(0,a.index),r=a[0]),t&&i.push(t),t=i.sort().join(", "),r&&(t+=r);i.length>0;)i.pop();i=n.pop(),i.pop(),i.push(`(${t})`),t=""}break;case",":e=!1,t=t.trim(),t&&i.push(t),t="";break;case"\\":e=!e,t+=s;break;default:t+=s,e=!1;break}return t=t.trim(),t&&i.push(t),t=i.sort().join(", "),t&&(t+=", "),t},m=window.comfyAPI.app.app;m.registerExtension(y),m.registerExtension(k),m.registerExtension(x)})(null,LiteGraph);
